# According to
# https://docs.travis-ci.com/user/languages/minimal-and-generic/#generic, the
# generic language includes Go.
language: go
go:
  - 1.13
os: osx
compiler: clang

addons:
  apt:
    packages:
      - python3-pip

install:
  - pip install pre-commit
  - go get golang.org/x/lint/golint
  - go get github.com/stretchr/testify
  - sudo cp "$GOPATH"/bin/* /usr/local/bin/
  - pip install cpplint

env:
  global:
  - GOPATH=$HOME/go
  - PATH=$GOPATH/bin:$PATH

cache:
  directories:
    # https://pre-commit.com/#travis-ci-example
    - $HOME/.cache/pre-commit

branches:
  only:
    - develop
jobs:
  include:
  - env: ARCH=MacOS
    script:
    - set -e
    - bash ./scripts/build_and_test.sh
  - env: ARCH=Linux
    script:
    - set -e
    - docker build -t gotorch:dev -f docker/Dockerfile .
    - docker run --rm -it -v $TRAVIS_BUILD_DIR:/go/src/github.com/wangkuiy/gotorch
        -w /go/src/github.com/wangkuiy/gotorch gotorch:dev scripts/build_and_test.sh
